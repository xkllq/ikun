"use strict";(self["webpackChunkhmtt81"]=self["webpackChunkhmtt81"]||[]).push([[585],{6585:function(n,t,e){e.r(t),e.d(t,{default:function(){return x}});var a=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",[e("van-nav-bar",{scopedSlots:n._u([{key:"left",fn:function(){return[e("div",{staticClass:"logo"})]},proxy:!0},{key:"right",fn:function(){return[e("van-button",{attrs:{round:"",icon:"search",type:"primary"},on:{click:function(t){return n.$router.push("/search")}}},[n._v("搜索 ")])]},proxy:!0}])}),e("van-tabs",{model:{value:n.active,callback:function(t){n.active=t},expression:"active"}},[n._l(n.mineChannels,(function(n){return e("van-tab",{key:n.id,attrs:{title:n.name}},[e("ArticleList",{attrs:{channel_id:n.id}})],1)})),e("div",{staticClass:"icon-wrap"},[e("van-icon",{attrs:{name:"wap-nav"},on:{click:function(t){n.showChannelList=!0}}})],1)],2),e("van-action-sheet",{attrs:{title:"频道管理"},model:{value:n.showChannelList,callback:function(t){n.showChannelList=t},expression:"showChannelList"}},[e("channel-list",{attrs:{mineChannels:n.mineChannels,allChannels:n.allChannels},on:{close:function(t){n.showChannelList=!1},fixBug:function(t){n.active--}},model:{value:n.active,callback:function(t){n.active=t},expression:"active"}})],1)],1)},s=[],i=e(6684),l=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",{ref:"scroll",staticClass:"artList",on:{scroll:n.onScroll}},[e("van-pull-refresh",{on:{refresh:n.onRefresh},model:{value:n.isLoading,callback:function(t){n.isLoading=t},expression:"isLoading"}},[e("van-list",{attrs:{finished:n.finished,"finished-text":"没有更多了"},on:{load:n.onLoad},model:{value:n.loading,callback:function(t){n.loading=t},expression:"loading"}},n._l(n.list,(function(t){return e("van-cell",{key:t.art_id,attrs:{to:"/articleDetail/"+t.art_id}},[e("div",[n._v(n._s(t.title))]),e("van-grid",{attrs:{border:!1,"column-num":t.cover.type}},n._l(t.cover.images,(function(n,t){return e("van-grid-item",{key:t},[e("van-image",{attrs:{fit:"cover",src:n}})],1)})),1),e("span",{staticClass:"info"},[n._v(" "+n._s(t.aut_name)+" "+n._s("评论数:"+t.comm_count)+" "+n._s(n._f("relvTime")(t.pubdate))+" ")])],1)})),1)],1)],1)},o=[],r={props:["channel_id"],name:"articleList",data(){return{list:[],loading:!1,finished:!1,timestamp:Date.now(),isLoading:!1,scroll:""}},activated(){this.$refs.scroll.scrollTop=this.scroll},methods:{async onLoad(){const n=await(0,i.P8)({channel_id:this.channel_id,timestamp:this.timestamp});this.list.push(...n.data.data.results),this.loading=!1,this.timestamp=n.data.data.pre_timestamp,null===this.timestamp&&(this.finished=!0)},async onRefresh(){const n=await(0,i.P8)({channel_id:this.channel_id,timestamp:Date.now()});this.list=n.data.data.results,this.isLoading=!1},onScroll(){this.scroll=this.$refs.scroll.scrollTop}}},c=r,h=e(1001),d=(0,h.Z)(c,l,o,!1,null,"be0eac56",null),u=d.exports,m=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",{staticClass:"mineChannel"},[e("div",{staticClass:"editChannel"},[e("span",[n._v("我的频道")]),e("van-button",{on:{click:function(t){n.showEdit=!n.showEdit}}},[n._v(" "+n._s(n.showEdit?"取消":"编辑")+" ")])],1),e("div",[e("van-grid",n._l(n.mineChannels,(function(t,a){return e("van-grid-item",{key:a,class:{active:a===n.value}},[e("van-icon",{directives:[{name:"show",rawName:"v-show",value:n.showEdit&&"推荐"!==t.name,expression:"showEdit && item.name !== '推荐'"}],attrs:{name:"cross"},on:{click:function(t){return n.del(a)}}}),e("span",{on:{click:function(t){return n.changeActive(a)}}},[n._v(n._s(t.name))])],1)})),1)],1),n._m(0),e("div",[e("van-grid",n._l(n.chooseChannels,(function(t){return e("van-grid-item",{key:t.id,attrs:{text:t.name},on:{click:function(e){return n.addChannels(t)}}})})),1)],1)])},v=[function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",{staticClass:"chooseChannel"},[e("span",[n._v("可选频道")])])}];const f="HMTT81_key",p=n=>{localStorage.setItem(f,JSON.stringify(n))},C=()=>JSON.parse(localStorage.getItem(f));var _={name:"channelList",props:{mineChannels:{required:!0,type:Array},allChannels:{required:!0,type:Array},value:{type:Number}},data(){return{arr:[],showEdit:!1}},methods:{addChannels(n){this.mineChannels.push(n),this.save()},changeActive(n){this.$emit("input",n),this.$emit("close")},del(n){this.mineChannels.splice(n,1),n<this.value&&this.$emit("fixBug"),this.save()},async save(){if(this.$store.state.tokenObj.token){const n=this.mineChannels.map(((n,t)=>({id:n.id,seq:t+1})));await(0,i.yk)({channels:n})}else p(this.mineChannels)}},computed:{chooseChannels(){return this.allChannels.filter((n=>!this.mineChannels.find((t=>t.id===n.id))))}}},g=_,k=(0,h.Z)(g,m,v,!1,null,"3a94e072",null),w=k.exports,y={name:"home-index",components:{ChannelList:w,ArticleList:u},data(){return{mineChannels:[],showChannelList:!1,allChannels:[],active:0}},methods:{},async created(){const n=C();if(this.$store.state.tokenObj.token||!n){const n=await(0,i.W4)();this.mineChannels=n.data.data.channels}else this.mineChannels=C();const t=await(0,i.uR)();this.allChannels=t.data.data.channels}},L=y,b=(0,h.Z)(L,a,s,!1,null,"1d244987",null),x=b.exports}}]);